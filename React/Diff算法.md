---
title: Diff算法过程
date: 2017-8-23
categories: React
---
在React中，构建UI界面的思路是由当前状态决定界面。前后两个状态就对应两套界面，然后由React来比较两个界面的区别，这就需要对DOM树进行Diff算法分析。

即给定任意两棵树，找到最少的转换步骤。但是标准的的Diff算法复杂度需要O(n^3)，这显然无法满足性能要求。

两点假设：
1. 两个相同的组件产生类似的DOM结构，不同的组件产生不同的DOM结构
2. 对于同一层次的一组子节点，他们可以通过唯一的id进行区分

当React在同一个位置遇到不同的组件时，也是简单的销毁第一个组件，而把新创建的组件加上去。这正是应用了第一个假设，不同的组件一般会产生不一样的DOM结构，与其浪费时间去比较它们基本上不会等价的DOM结构，还不如完全创建一个新的组件加上去。
由这一React对不同类型的节点的处理逻辑我们很容易得到推论，那就是React的DOM Diff算法实际上只会对树进行逐层比较，如下所述。
## 不同节点类型的比较
在React中即比较两个虚拟DOM节点，当两个节点不同时，应该如何处理。这分为两种情况：
1. 节点类型不同 ，
2. 节点类型相同，但是属性不同。

### 节点类型不同
#### 逐层比较
React只会对相同层的的DOM节点进行比较，即同一个父节点下的所有子节点。当发现节点已经不存在，则该节点及其子节点会被完全删除掉，不会用于进一步的比较。这样只需要对树进行一次遍历，便能完成整个DOM树的比较。

### 相同类型节点
第二种节点的比较是相同类型的节点，算法就相对简单而容易理解。React会对属性(例如style)进行重设从而实现节点的转换。
### 列表节点的比较
上面介绍了对于不在同一层的节点的比较，即使它们完全一样，也会销毁并重新创建。那么当它们在同一层时，又是如何处理的呢？这就涉及到列表节点的Diff算法。
如果给每个节点唯一的标识（key），那么React能够找到正确的位置去插入新的节点