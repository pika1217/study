---
title: 前端性能优化方案
date: 2017-7-16
tags：前端优化
categories: 前端综合
---
## 使用CDN【内容分发网络】加速
### 定义
CDN【Content Delivery Network】，即内容分发网络。属于http缓存技术中的一种。

### 原理
其基本思路是尽可能的避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快、更稳定。通过在网络各处放置节点服务器所构成的现有互联网基础之上的一层虚拟网络，CDN系统能够实时的根据网络流量和各节点的连接，负载状况以及用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。其目的就是使用户能够就近的获取请求数据，解决网络访问拥挤状况，提高用户访问系统的响应时间。管理分布在多个地理位置上的服务器，其系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重定向到一个能提供最好用户体验的服务节点上。它位于网络的边缘，据用户仅“一跳”之隔。代理缓存提供数据中心服务器的一个镜像，当用户对某网址访问的请求并非第一次，那么代理缓存在很大概率上缓存了域名，就不需要大费周章通过DNS【域名服务系统】来获取对应域名。

## 减少http请求【减少请求数，降低请求量】
### 脚本合并
#### 原理
通常一个大型网站需要依赖多个JS文件。可以把多个文件合并成一个，这样只需要引用一个文件

1.Grunt     2. JSCompress
### CSS雪碧图
优点:
1. 减少http请求，提高页面加载速度。只需加载一张图片，且由于只需要一个对应的色表，这张图片的大小很可能比拼合前的总尺寸小。
2. 减少鼠标滑过的bug：IE6不会主动预加载：hover中的背景图片，因此使用多张图片时会出现闪白的现象。
缺点:
1. 最大的问题是内存的使用：除非非常小心的组织，否则会留下大量无用的空白。
2. 影响页面缩放功能：缩放时要避免雪碧中相邻图片露出来。

### 文件压缩
包括CSS、JavaScript、图片的压缩。

JavaScript：
1. 最小化：删除注释和空格等不必要的字符。安全、直白，文件减少21%。
2. 混淆：删除注释和空格，将函数名和变量名替换成短的字符串，难于反向工程。复杂，容易产生问题，文件减少25%。

方法:
1. JSMin
2. YUI Compressor在线
3. 在线JS/CSS/HTML压缩
4. JavaScript压缩/解压缩
5. grunt
6. 批量图片压缩
7. 压缩HTTP响应内容:Gzip

### 延迟加载图片【Lazy Load Images】

首先只加载第一屏的图片，当用户滚动访问后面的内容时在加载相应图片。
方法：将图片的src属性值存放在一个非src的自定义属性中，判断图片进入可视区域后将路径赋值给src属性。
### CSS3图标

iconfont公开图标库
Font Awesome
### 避免重定向
301：永久重定向，抓取新内容的同时也将旧的网址替换为重定向之后的网址；

302：暂时重定向，抓取新的内容而保留旧的网址

SEO：302好于301

重定向会增加http请求数，但必要的重定向有利于提高用户体验

方法：

定义链接URL时使用最完整的、最直接的地址。如：

1. 使用www.baidu.com而非baidu.com
    
2. 在使用Response.Redirect的时候，设置第二个参数为false.
    
## 代码优化
### 减少对DOM的操作

对DOM的操作代价是昂贵的，这在网页中通常是一个性能瓶颈。
减少对DOM元素的查询与修改：
1. 查询：需多次访问的可以保存在变量中。
2. 修改：使用innerHTML代替DOM操作。
### 减少重排与重绘
原理：页面生成时会进行至少一次渲染，用户访问过程中还可能不停地重新渲染。情况如下：

1. 修改DOM，修改样式表，用户事件（比如鼠标悬停、页面滚动、输入框键入文字、改变窗口大小等等）重新渲染，就需要重新生成布局和重新绘制。前者叫做“重排【reflow】”，表现为页面布局出现变动。后者叫做“重绘【repaint】”。“重绘”不一定需要“重排”，如改变元素颜色，因为此时页面布局并未发生改变；而“重排”一定会导致“重绘”，布局的变化会同时触发“重排”和“重绘”。“重排”和“重绘”均会使性能下降，因此要尽量避免。

2. 一般规则：样式表越简单，重排和重绘就越快；重排和重绘的DOM元素层级越高，成本越高；table元素的重排和重绘成本高于div元素。

3. 优化方法
    1. 通过class改变样式，避免逐条改变；
    2. 对display：none的元素操作不会引发重排和重绘，因此需要多次操作的元素可改变其display属性再进行操作，完成操作后再将其显示，这样只需要两次重排和重绘；另外，visibility：hidden的元素操作只重绘；
    3. 脱离文档流的元素重排开销较小【如：position为absolute或fixed，float元素】，因为对文档流中元素无影响；

### 避免CSS表达式
CSS表达式会进行大量重复计算，甚至当鼠标在页面移动时也在不停执行，这大大影响性能。尽量使用一次性表达式，避免动态计算。
## 缓存Ajax
例如jQuery中的Ajax中cache:true
Ajax缓存和http缓存效果相同。Ajax页面缓存是ajax处理数据时对一些重复相同数据进行一个缓存操作，这种设计使客户端对一些静态页面内容的请求，比如图片，css文件，js脚本等，变得更加快捷，提高了页面的响应速度，也节省了网络通信资源。

## yahoo军规35条